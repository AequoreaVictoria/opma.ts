var exports$1={},TYPED_OK="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(e,t){return Object.prototype.hasOwnProperty.call(e,t)}exports$1.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)_has(i,s)&&(e[s]=i[s])}}return e},exports$1.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var fnTyped={arraySet:function(e,t,i,s,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+s),n);else for(var o=0;o<s;o++)e[n+o]=t[i+o]},flattenChunks:function(e){var t,i,s,n,o,r;for(s=0,t=0,i=e.length;t<i;t++)s+=e[t].length;for(r=new Uint8Array(s),n=0,t=0,i=e.length;t<i;t++)o=e[t],r.set(o,n),n+=o.length;return r}},fnUntyped={arraySet:function(e,t,i,s,n){for(var o=0;o<s;o++)e[n+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};function adler32(e,t,i,s){for(var n=65535&e|0,o=e>>>16&65535|0,r=0;0!==i;){i-=r=i>2e3?2e3:i;do{o=o+(n=n+t[s++]|0)|0}while(--r);n%=65521,o%=65521}return n|o<<16|0}function makeTable(){for(var e,t=[],i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}exports$1.setTyped=function(e){e?(exports$1.Buf8=Uint8Array,exports$1.Buf16=Uint16Array,exports$1.Buf32=Int32Array,exports$1.assign(exports$1,fnTyped)):(exports$1.Buf8=Array,exports$1.Buf16=Array,exports$1.Buf32=Array,exports$1.assign(exports$1,fnUntyped))},exports$1.setTyped(TYPED_OK);var crcTable=makeTable();function crc32(e,t,i,s){var n=crcTable,o=s+i;e^=-1;for(var r=s;r<o;r++)e=e>>>8^n[255&(e^t[r])];return-1^e}var BAD=30,TYPE=12;function inflate_fast(e,t){var i,s,n,o,r,a,h,l,f,c,d,u,p,_,g,m,E,w,k,v,S,b,T,R,A;i=e.state,s=e.next_in,R=e.input,n=s+(e.avail_in-5),o=e.next_out,A=e.output,r=o-(t-e.avail_out),a=o+(e.avail_out-257),h=i.dmax,l=i.wsize,f=i.whave,c=i.wnext,d=i.window,u=i.hold,p=i.bits,_=i.lencode,g=i.distcode,m=(1<<i.lenbits)-1,E=(1<<i.distbits)-1;e:do{p<15&&(u+=R[s++]<<p,p+=8,u+=R[s++]<<p,p+=8),w=_[u&m];t:for(;;){if(u>>>=k=w>>>24,p-=k,0===(k=w>>>16&255))A[o++]=65535&w;else{if(!(16&k)){if(0==(64&k)){w=_[(65535&w)+(u&(1<<k)-1)];continue t}if(32&k){i.mode=TYPE;break e}e.msg="invalid literal/length code",i.mode=BAD;break e}v=65535&w,(k&=15)&&(p<k&&(u+=R[s++]<<p,p+=8),v+=u&(1<<k)-1,u>>>=k,p-=k),p<15&&(u+=R[s++]<<p,p+=8,u+=R[s++]<<p,p+=8),w=g[u&E];i:for(;;){if(u>>>=k=w>>>24,p-=k,!(16&(k=w>>>16&255))){if(0==(64&k)){w=g[(65535&w)+(u&(1<<k)-1)];continue i}e.msg="invalid distance code",i.mode=BAD;break e}if(S=65535&w,p<(k&=15)&&(u+=R[s++]<<p,(p+=8)<k&&(u+=R[s++]<<p,p+=8)),(S+=u&(1<<k)-1)>h){e.msg="invalid distance too far back",i.mode=BAD;break e}if(u>>>=k,p-=k,S>(k=o-r)){if((k=S-k)>f&&i.sane){e.msg="invalid distance too far back",i.mode=BAD;break e}if(b=0,T=d,0===c){if(b+=l-k,k<v){v-=k;do{A[o++]=d[b++]}while(--k);b=o-S,T=A}}else if(c<k){if(b+=l+c-k,(k-=c)<v){v-=k;do{A[o++]=d[b++]}while(--k);if(b=0,c<v){v-=k=c;do{A[o++]=d[b++]}while(--k);b=o-S,T=A}}}else if(b+=c-k,k<v){v-=k;do{A[o++]=d[b++]}while(--k);b=o-S,T=A}for(;v>2;)A[o++]=T[b++],A[o++]=T[b++],A[o++]=T[b++],v-=3;v&&(A[o++]=T[b++],v>1&&(A[o++]=T[b++]))}else{b=o-S;do{A[o++]=A[b++],A[o++]=A[b++],A[o++]=A[b++],v-=3}while(v>2);v&&(A[o++]=A[b++],v>1&&(A[o++]=A[b++]))}break}}break}}while(s<n&&o<a);s-=v=p>>3,u&=(1<<(p-=v<<3))-1,e.next_in=s,e.next_out=o,e.avail_in=s<n?n-s+5:5-(s-n),e.avail_out=o<a?a-o+257:257-(o-a),i.hold=u,i.bits=p}var MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function inflate_table(e,t,i,s,n,o,r,a){var h,l,f,c,d,u,p,_,g,m=a.bits,E=0,w=0,k=0,v=0,S=0,b=0,T=0,R=0,A=0,x=0,C=null,O=0,D=new exports$1.Buf16(MAXBITS+1),y=new exports$1.Buf16(MAXBITS+1),I=null,B=0;for(E=0;E<=MAXBITS;E++)D[E]=0;for(w=0;w<s;w++)D[t[i+w]]++;for(S=m,v=MAXBITS;v>=1&&0===D[v];v--);if(S>v&&(S=v),0===v)return n[o++]=20971520,n[o++]=20971520,a.bits=1,0;for(k=1;k<v&&0===D[k];k++);for(S<k&&(S=k),R=1,E=1;E<=MAXBITS;E++)if(R<<=1,(R-=D[E])<0)return-1;if(R>0&&(e===CODES||1!==v))return-1;for(y[1]=0,E=1;E<MAXBITS;E++)y[E+1]=y[E]+D[E];for(w=0;w<s;w++)0!==t[i+w]&&(r[y[t[i+w]]++]=w);if(e===CODES?(C=I=r,u=19):e===LENS?(C=lbase,O-=257,I=lext,B-=257,u=256):(C=dbase,I=dext,u=-1),x=0,w=0,E=k,d=o,b=S,T=0,f=-1,c=(A=1<<S)-1,e===LENS&&A>ENOUGH_LENS||e===DISTS&&A>ENOUGH_DISTS)return 1;for(;;){p=E-T,r[w]<u?(_=0,g=r[w]):r[w]>u?(_=I[B+r[w]],g=C[O+r[w]]):(_=96,g=0),h=1<<E-T,k=l=1<<b;do{n[d+(x>>T)+(l-=h)]=p<<24|_<<16|g|0}while(0!==l);for(h=1<<E-1;x&h;)h>>=1;if(0!==h?(x&=h-1,x+=h):x=0,w++,0==--D[E]){if(E===v)break;E=t[i+r[w]]}if(E>S&&(x&c)!==f){for(0===T&&(T=S),d+=k,R=1<<(b=E-T);b+T<v&&!((R-=D[b+T])<=0);)b++,R<<=1;if(A+=1<<b,e===LENS&&A>ENOUGH_LENS||e===DISTS&&A>ENOUGH_DISTS)return 1;n[f=x&c]=S<<24|b<<16|d-o|0}}return 0!==x&&(n[d+x]=E-T<<24|64<<16|0),a.bits=S,0}var CODES$1=0,LENS$1=1,DISTS$1=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE$1=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD$1=30,MEM=31,SYNC=32,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS;function zswap32(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new exports$1.Buf16(320),this.work=new exports$1.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new exports$1.Buf32(ENOUGH_LENS$1),t.distcode=t.distdyn=new exports$1.Buf32(ENOUGH_DISTS$1),t.sane=1,t.back=-1,Z_OK):Z_STREAM_ERROR}function inflateReset(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)):Z_STREAM_ERROR}function inflateReset2(e,t){var i,s;return e&&e.state?(s=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,inflateReset(e))):Z_STREAM_ERROR}function inflateInit2(e,t){var i,s;return e?(s=new InflateState,e.state=s,s.window=null,(i=inflateReset2(e,t))!==Z_OK&&(e.state=null),i):Z_STREAM_ERROR}function inflateInit(e){return inflateInit2(e,DEF_WBITS)}var lenfix,distfix,virgin=!0;function fixedtables(e){if(virgin){var t;for(lenfix=new exports$1.Buf32(512),distfix=new exports$1.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inflate_table(LENS$1,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inflate_table(DISTS$1,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5}function updatewindow(e,t,i,s){var n,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new exports$1.Buf8(o.wsize)),s>=o.wsize?(exports$1.arraySet(o.window,t,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>s&&(n=s),exports$1.arraySet(o.window,t,i-s,n,o.wnext),(s-=n)?(exports$1.arraySet(o.window,t,i-s,s,0),o.wnext=s,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0}function inflate(e,t){var i,s,n,o,r,a,h,l,f,c,d,u,p,_,g,m,E,w,k,v,S,b,T,R,A=0,x=new exports$1.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR;(i=e.state).mode===TYPE$1&&(i.mode=TYPEDO),r=e.next_out,n=e.output,h=e.avail_out,o=e.next_in,s=e.input,a=e.avail_in,l=i.hold,f=i.bits,c=a,d=h,b=Z_OK;e:for(;;)switch(i.mode){case HEAD:if(0===i.wrap){i.mode=TYPEDO;break}for(;f<16;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(2&i.wrap&&35615===l){i.check=0,x[0]=255&l,x[1]=l>>>8&255,i.check=crc32(i.check,x,2,0),l=0,f=0,i.mode=FLAGS;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",i.mode=BAD$1;break}if((15&l)!==Z_DEFLATED){e.msg="unknown compression method",i.mode=BAD$1;break}if(f-=4,S=8+(15&(l>>>=4)),0===i.wbits)i.wbits=S;else if(S>i.wbits){e.msg="invalid window size",i.mode=BAD$1;break}i.dmax=1<<S,e.adler=i.check=1,i.mode=512&l?DICTID:TYPE$1,l=0,f=0;break;case FLAGS:for(;f<16;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(i.flags=l,(255&i.flags)!==Z_DEFLATED){e.msg="unknown compression method",i.mode=BAD$1;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=BAD$1;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=crc32(i.check,x,2,0)),l=0,f=0,i.mode=TIME;case TIME:for(;f<32;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}i.head&&(i.head.time=l),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,x[2]=l>>>16&255,x[3]=l>>>24&255,i.check=crc32(i.check,x,4,0)),l=0,f=0,i.mode=OS;case OS:for(;f<16;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=crc32(i.check,x,2,0)),l=0,f=0,i.mode=EXLEN;case EXLEN:if(1024&i.flags){for(;f<16;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&(x[0]=255&l,x[1]=l>>>8&255,i.check=crc32(i.check,x,2,0)),l=0,f=0}else i.head&&(i.head.extra=null);i.mode=EXTRA;case EXTRA:if(1024&i.flags&&((u=i.length)>a&&(u=a),u&&(i.head&&(S=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),exports$1.arraySet(i.head.extra,s,o,u,S)),512&i.flags&&(i.check=crc32(i.check,s,u,o)),a-=u,o+=u,i.length-=u),i.length))break e;i.length=0,i.mode=NAME;case NAME:if(2048&i.flags){if(0===a)break e;u=0;do{S=s[o+u++],i.head&&S&&i.length<65536&&(i.head.name+=String.fromCharCode(S))}while(S&&u<a);if(512&i.flags&&(i.check=crc32(i.check,s,u,o)),a-=u,o+=u,S)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=COMMENT;case COMMENT:if(4096&i.flags){if(0===a)break e;u=0;do{S=s[o+u++],i.head&&S&&i.length<65536&&(i.head.comment+=String.fromCharCode(S))}while(S&&u<a);if(512&i.flags&&(i.check=crc32(i.check,s,u,o)),a-=u,o+=u,S)break e}else i.head&&(i.head.comment=null);i.mode=HCRC;case HCRC:if(512&i.flags){for(;f<16;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(l!==(65535&i.check)){e.msg="header crc mismatch",i.mode=BAD$1;break}l=0,f=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=TYPE$1;break;case DICTID:for(;f<32;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}e.adler=i.check=zswap32(l),l=0,f=0,i.mode=DICT;case DICT:if(0===i.havedict)return e.next_out=r,e.avail_out=h,e.next_in=o,e.avail_in=a,i.hold=l,i.bits=f,Z_NEED_DICT;e.adler=i.check=1,i.mode=TYPE$1;case TYPE$1:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(i.last){l>>>=7&f,f-=7&f,i.mode=CHECK;break}for(;f<3;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}switch(i.last=1&l,f-=1,3&(l>>>=1)){case 0:i.mode=STORED;break;case 1:if(fixedtables(i),i.mode=LEN_,t===Z_TREES){l>>>=2,f-=2;break e}break;case 2:i.mode=TABLE;break;case 3:e.msg="invalid block type",i.mode=BAD$1}l>>>=2,f-=2;break;case STORED:for(l>>>=7&f,f-=7&f;f<32;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=BAD$1;break}if(i.length=65535&l,l=0,f=0,i.mode=COPY_,t===Z_TREES)break e;case COPY_:i.mode=COPY;case COPY:if(u=i.length){if(u>a&&(u=a),u>h&&(u=h),0===u)break e;exports$1.arraySet(n,s,o,u,r),a-=u,o+=u,h-=u,r+=u,i.length-=u;break}i.mode=TYPE$1;break;case TABLE:for(;f<14;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(i.nlen=257+(31&l),l>>>=5,f-=5,i.ndist=1+(31&l),l>>>=5,f-=5,i.ncode=4+(15&l),l>>>=4,f-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=BAD$1;break}i.have=0,i.mode=LENLENS;case LENLENS:for(;i.have<i.ncode;){for(;f<3;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}i.lens[C[i.have++]]=7&l,l>>>=3,f-=3}for(;i.have<19;)i.lens[C[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,T={bits:i.lenbits},b=inflate_table(CODES$1,i.lens,0,19,i.lencode,0,i.work,T),i.lenbits=T.bits,b){e.msg="invalid code lengths set",i.mode=BAD$1;break}i.have=0,i.mode=CODELENS;case CODELENS:for(;i.have<i.nlen+i.ndist;){for(;m=(A=i.lencode[l&(1<<i.lenbits)-1])>>>16&255,E=65535&A,!((g=A>>>24)<=f);){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(E<16)l>>>=g,f-=g,i.lens[i.have++]=E;else{if(16===E){for(R=g+2;f<R;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(l>>>=g,f-=g,0===i.have){e.msg="invalid bit length repeat",i.mode=BAD$1;break}S=i.lens[i.have-1],u=3+(3&l),l>>>=2,f-=2}else if(17===E){for(R=g+3;f<R;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}f-=g,S=0,u=3+(7&(l>>>=g)),l>>>=3,f-=3}else{for(R=g+7;f<R;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}f-=g,S=0,u=11+(127&(l>>>=g)),l>>>=7,f-=7}if(i.have+u>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=BAD$1;break}for(;u--;)i.lens[i.have++]=S}}if(i.mode===BAD$1)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=BAD$1;break}if(i.lenbits=9,T={bits:i.lenbits},b=inflate_table(LENS$1,i.lens,0,i.nlen,i.lencode,0,i.work,T),i.lenbits=T.bits,b){e.msg="invalid literal/lengths set",i.mode=BAD$1;break}if(i.distbits=6,i.distcode=i.distdyn,T={bits:i.distbits},b=inflate_table(DISTS$1,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,T),i.distbits=T.bits,b){e.msg="invalid distances set",i.mode=BAD$1;break}if(i.mode=LEN_,t===Z_TREES)break e;case LEN_:i.mode=LEN;case LEN:if(a>=6&&h>=258){e.next_out=r,e.avail_out=h,e.next_in=o,e.avail_in=a,i.hold=l,i.bits=f,inflate_fast(e,d),r=e.next_out,n=e.output,h=e.avail_out,o=e.next_in,s=e.input,a=e.avail_in,l=i.hold,f=i.bits,i.mode===TYPE$1&&(i.back=-1);break}for(i.back=0;m=(A=i.lencode[l&(1<<i.lenbits)-1])>>>16&255,E=65535&A,!((g=A>>>24)<=f);){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(m&&0==(240&m)){for(w=g,k=m,v=E;m=(A=i.lencode[v+((l&(1<<w+k)-1)>>w)])>>>16&255,E=65535&A,!(w+(g=A>>>24)<=f);){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}l>>>=w,f-=w,i.back+=w}if(l>>>=g,f-=g,i.back+=g,i.length=E,0===m){i.mode=LIT;break}if(32&m){i.back=-1,i.mode=TYPE$1;break}if(64&m){e.msg="invalid literal/length code",i.mode=BAD$1;break}i.extra=15&m,i.mode=LENEXT;case LENEXT:if(i.extra){for(R=i.extra;f<R;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,f-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=DIST;case DIST:for(;m=(A=i.distcode[l&(1<<i.distbits)-1])>>>16&255,E=65535&A,!((g=A>>>24)<=f);){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(0==(240&m)){for(w=g,k=m,v=E;m=(A=i.distcode[v+((l&(1<<w+k)-1)>>w)])>>>16&255,E=65535&A,!(w+(g=A>>>24)<=f);){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}l>>>=w,f-=w,i.back+=w}if(l>>>=g,f-=g,i.back+=g,64&m){e.msg="invalid distance code",i.mode=BAD$1;break}i.offset=E,i.extra=15&m,i.mode=DISTEXT;case DISTEXT:if(i.extra){for(R=i.extra;f<R;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,f-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=BAD$1;break}i.mode=MATCH;case MATCH:if(0===h)break e;if(u=d-h,i.offset>u){if((u=i.offset-u)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=BAD$1;break}u>i.wnext?(u-=i.wnext,p=i.wsize-u):p=i.wnext-u,u>i.length&&(u=i.length),_=i.window}else _=n,p=r-i.offset,u=i.length;u>h&&(u=h),h-=u,i.length-=u;do{n[r++]=_[p++]}while(--u);0===i.length&&(i.mode=LEN);break;case LIT:if(0===h)break e;n[r++]=i.length,h--,i.mode=LEN;break;case CHECK:if(i.wrap){for(;f<32;){if(0===a)break e;a--,l|=s[o++]<<f,f+=8}if(d-=h,e.total_out+=d,i.total+=d,d&&(e.adler=i.check=i.flags?crc32(i.check,n,d,r-d):adler32(i.check,n,d,r-d)),d=h,(i.flags?l:zswap32(l))!==i.check){e.msg="incorrect data check",i.mode=BAD$1;break}l=0,f=0}i.mode=LENGTH;case LENGTH:if(i.wrap&&i.flags){for(;f<32;){if(0===a)break e;a--,l+=s[o++]<<f,f+=8}if(l!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=BAD$1;break}l=0,f=0}i.mode=DONE;case DONE:b=Z_STREAM_END;break e;case BAD$1:b=Z_DATA_ERROR;break e;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}return e.next_out=r,e.avail_out=h,e.next_in=o,e.avail_in=a,i.hold=l,i.bits=f,(i.wsize||d!==e.avail_out&&i.mode<BAD$1&&(i.mode<CHECK||t!==Z_FINISH))&&updatewindow(e,e.output,e.next_out,d-e.avail_out),c-=e.avail_in,d-=e.avail_out,e.total_in+=c,e.total_out+=d,i.total+=d,i.wrap&&d&&(e.adler=i.check=i.flags?crc32(i.check,n,d,e.next_out-d):adler32(i.check,n,d,e.next_out-d)),e.data_type=i.bits+(i.last?64:0)+(i.mode===TYPE$1?128:0)+(i.mode===LEN_||i.mode===COPY_?256:0),(0===c&&0===d||t===Z_FINISH)&&b===Z_OK&&(b=Z_BUF_ERROR),b}function inflateEnd(e){if(!e||!e.state)return Z_STREAM_ERROR;var t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK}function inflateGetHeader(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?Z_STREAM_ERROR:(i.head=t,t.done=!1,Z_OK):Z_STREAM_ERROR}function inflateSetDictionary(e,t){var i,s=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==DICT?Z_STREAM_ERROR:i.mode===DICT&&adler32(1,t,s,0)!==i.check?Z_DATA_ERROR:updatewindow(e,t,s,s)?(i.mode=MEM,Z_MEM_ERROR):(i.havedict=1,Z_OK):Z_STREAM_ERROR}var exports$2={};exports$2.inflateReset=inflateReset,exports$2.inflateReset2=inflateReset2,exports$2.inflateResetKeep=inflateResetKeep,exports$2.inflateInit=inflateInit,exports$2.inflateInit2=inflateInit2,exports$2.inflate=inflate,exports$2.inflateEnd=inflateEnd,exports$2.inflateGetHeader=inflateGetHeader,exports$2.inflateSetDictionary=inflateSetDictionary,exports$2.inflateInfo="pako inflate (from Nodeca project)";var exports$3={},STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(e){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}for(var _utf8len=new exports$1.Buf8(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;function buf2binstring(e,t){if(t<65537&&(e.subarray&&STR_APPLY_UIA_OK||!e.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,exports$1.shrinkBuf(e,t));for(var i="",s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i}_utf8len[254]=_utf8len[254]=1,exports$3.string2buf=function(e){var t,i,s,n,o,r=e.length,a=0;for(n=0;n<r;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<r&&56320==(64512&(s=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new exports$1.Buf8(a),o=0,n=0;o<a;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<r&&56320==(64512&(s=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},exports$3.buf2binstring=function(e){return buf2binstring(e,e.length)},exports$3.binstring2buf=function(e){for(var t=new exports$1.Buf8(e.length),i=0,s=t.length;i<s;i++)t[i]=e.charCodeAt(i);return t},exports$3.buf2string=function(e,t){var i,s,n,o,r=t||e.length,a=new Array(2*r);for(s=0,i=0;i<r;)if((n=e[i++])<128)a[s++]=n;else if((o=_utf8len[n])>4)a[s++]=65533,i+=o-1;else{for(n&=2===o?31:3===o?15:7;o>1&&i<r;)n=n<<6|63&e[i++],o--;o>1?a[s++]=65533:n<65536?a[s++]=n:(n-=65536,a[s++]=55296|n>>10&1023,a[s++]=56320|1023&n)}return buf2binstring(a,s)},exports$3.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0?t:0===i?t:i+_utf8len[e[i]]>t?i:t};var c={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},msg={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var toString=Object.prototype.toString;function Inflate(e){if(!(this instanceof Inflate))return new Inflate(e);this.options=exports$1.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;var i=exports$2.inflateInit2(this.strm,t.windowBits);if(i!==c.Z_OK)throw new Error(msg[i]);this.header=new GZheader,exports$2.inflateGetHeader(this.strm,this.header)}function inflate$1(e,t){var i=new Inflate(t);if(i.push(e,!0),i.err)throw i.msg||msg[i.err];return i.result}function inflateRaw(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate.prototype.push=function(e,t){var i,s,n,o,r,a,h=this.strm,l=this.options.chunkSize,f=this.options.dictionary,d=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof e?h.input=exports$3.binstring2buf(e):"[object ArrayBuffer]"===toString.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new exports$1.Buf8(l),h.next_out=0,h.avail_out=l),(i=exports$2.inflate(h,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&f&&(a="string"==typeof f?exports$3.string2buf(f):"[object ArrayBuffer]"===toString.call(f)?new Uint8Array(f):f,i=exports$2.inflateSetDictionary(this.strm,a)),i===c.Z_BUF_ERROR&&!0===d&&(i=c.Z_OK,d=!1),i!==c.Z_STREAM_END&&i!==c.Z_OK)return this.onEnd(i),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&i!==c.Z_STREAM_END&&(0!==h.avail_in||s!==c.Z_FINISH&&s!==c.Z_SYNC_FLUSH)||("string"===this.options.to?(n=exports$3.utf8border(h.output,h.next_out),o=h.next_out-n,r=exports$3.buf2string(h.output,n),h.next_out=o,h.avail_out=l-o,o&&exports$1.arraySet(h.output,h.output,n,o,0),this.onData(r)):this.onData(exports$1.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(d=!0)}while((h.avail_in>0||0===h.avail_out)&&i!==c.Z_STREAM_END);return i===c.Z_STREAM_END&&(s=c.Z_FINISH),s===c.Z_FINISH?(i=exports$2.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===c.Z_OK):s!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),h.avail_out=0,!0)},Inflate.prototype.onData=function(e){this.chunks.push(e)},Inflate.prototype.onEnd=function(e){e===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=exports$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Pako={};Pako.Inflate=Inflate,Pako.inflate=inflate$1,Pako.inflateRaw=inflateRaw,Pako.ungzip=inflate$1;class VGM{constructor(e){let t=new DataView(e);if(31==t.getUint8(0)&&139==t.getUint8(1)){const i=Pako.inflate(new Uint8Array(e)),s=new ArrayBuffer(i.length),n=new Uint8Array(s);i.map((e,t)=>n[t]=e),t=new DataView(s)}if(t.getUint8(0)!="V".charCodeAt(0)||t.getUint8(1)!="g".charCodeAt(0)||t.getUint8(2)!="m".charCodeAt(0)||t.getUint8(3)!=" ".charCodeAt(0))throw"Invalid VGM ident!";if(this.version=t.getUint32(8,!0),this.version<336)throw"Only VGM 1.50+ files supported!";if(this.eofOffset=t.getUint32(4,!0),this.gd3Offset=t.getUint32(20,!0),this.totalSamples=t.getUint32(24,!0),this.loopOffset=t.getUint32(28,!0),this.loopSamples=t.getUint32(32,!0),this.rate=t.getUint32(36,!0),this.ym2151Clock=t.getUint32(48,!0),this.ym2151Multiplier=this.ym2151Clock?1:0,this.vgmDataOffset=t.getUint32(52,!0),this.ay8910Clock=this.version>=337?t.getUint32(116,!0):0,this.ay8910Type=this.version>=337?t.getUint8(120):0,this.ay8910Flags=this.version>=337?t.getUint8(121):0,this.ay8910Multiplier=this.ay8910Clock?1:0,this.volumeModifier=this.version>=352?t.getUint8(124):0,this.loopBase=this.version>=352?t.getUint8(126):0,this.loopModifier=this.version>=337?t.getUint8(127):0,this.okim6258Clock=this.version>=353?t.getUint32(144,!0):0,this.okim6258Flags=this.version>=353?t.getUint8(148):0,this.okim6258Multiplier=this.okim6258Clock?1:0,this.k051649Clock=this.version>=353?t.getUint32(156,!0):0,this.k051649Multiplier=this.k051649Clock?1:0,this.extraHeaderOffset=this.version>=368?t.getUint32(188,!0):0,1073741824&this.ym2151Clock&&(this.ym2151Clock&=3221225471,this.ym2151Multiplier=2),1073741824&this.ay8910Clock&&(this.ay8910Clock&=3221225471,this.ay8910Multiplier=2),1073741824&this.okim6258Clock&&(this.okim6258Clock&=3221225471,this.okim6258Multiplier=2),1073741824&this.k051649Clock&&(this.k051649Clock&=3221225471,this.k051649Multiplier=2),this.gd3Version=0,this.gd3Length=0,this.gd3Tags={trackNameEn:"",trackNameJp:"",gameNameEn:"",gameNameJp:"",systemNameEn:"",systemNameJp:"",trackAuthorEn:"",trackAuthorJp:"",releaseDate:"",convertedBy:"",notes:""},this.gd3Offset){const e=this.gd3Offset+20;if(t.getUint8(e+0)!="G".charCodeAt(0)||t.getUint8(e+1)!="d".charCodeAt(0)||t.getUint8(e+2)!="3".charCodeAt(0)||t.getUint8(e+3)!=" ".charCodeAt(0))throw"Invalid GD3 ident!";this.gd3Version=t.getUint32(e+4,!0),this.gd3Length=t.getUint32(e+8,!0);const i=Object.keys(this.gd3Tags);for(let s=0,n=0;s<this.gd3Length;s+=2){const o=t.getUint16(e+12+s,!0);0==o?n++:this.gd3Tags[i[n]]+=String.fromCharCode(o)}}this.data=t}}const DECIMATE_FACTOR=8,FIR_SIZE=192,DC_FILTER_SIZE=1024;class ToneChannel{constructor(){this.toneCounter=0,this.tonePeriod=0,this.tone=0,this.tOff=0,this.nOff=0,this.eOn=0,this.volume=0}}class PSG{updateTone(e){const t=this.channels[e];return++t.toneCounter>=t.tonePeriod&&(t.toneCounter=0,t.tone^=1),t.tone}updateNoise(){if(++this.noiseCounter>=this.noisePeriod<<1){this.noiseCounter=0;const e=1&(this.noise^this.noise>>3);this.noise=this.noise>>1|e<<16}return 1&this.noise}slideUp(e){++e.envelope>31&&(e.envelopeSegment^=1,e.resetSegment())}slideDown(e){--e.envelope<0&&(e.envelopeSegment^=1,e.resetSegment())}holdTop(){}holdBottom(){}resetSegment(){const e=this.envelopes[this.envelopeShape][this.envelopeSegment];this.envelope=e==this.slideDown||e==this.holdTop?31:0}updateEnvelope(){return++this.envelopeCounter>=this.envelopePeriod&&(this.envelopeCounter=0,this.envelopes[this.envelopeShape][this.envelopeSegment](this)),this.envelope}updateMixer(e){let t;const i=this.updateNoise(),s=this.updateEnvelope();this.output[e]=0;for(let n=0;n<this.channels.length;n++)t=(this.updateTone(n)|this.channels[n].tOff)&(i|this.channels[n].nOff),t*=this.channels[n].eOn?s:2*this.channels[n].volume+1,this.output[e]+=this.dacTable[t]}setTone(e,t){t&=4095,this.channels[e].tonePeriod=(0==t?1:0)|t}setNoise(e){this.noisePeriod=31&e}setMixer(e,t,i,s){this.channels[e].tOff=1&t,this.channels[e].nOff=1&i,this.channels[e].eOn=s}setVolume(e,t){this.channels[e].volume=15&t}setEnvelope(e){e&=65535,this.envelopePeriod=(0==e?1:0)|e}setEnvelopeShape(e){this.envelopeShape=15&e,this.envelopeCounter=0,this.envelopeSegment=0,this.resetSegment()}decimate(e){const t=-4618311399205194e-21*(e[1]+e[191])+-1117761640887225e-20*(e[2]+e[190])+-18610264502005432e-21*(e[3]+e[189])+-2513458613563101e-20*(e[4]+e[188])+-28494281690666197e-21*(e[5]+e[187])+-2639682879327516e-20*(e[6]+e[186])+-17094212558802156e-21*(e[7]+e[185])+23798193576966866e-21*(e[9]+e[183])+5128116024220218e-20*(e[10]+e[182])+7762197826243427e-20*(e[11]+e[181])+9675942666412042e-20*(e[12]+e[180])+.00010240229300393402*(e[13]+e[179])+893446142180771e-19*(e[14]+e[178])+5487570011894918e-20*(e[15]+e[177])+-6983908221068016e-20*(e[17]+e[175])+-.0001447966132360757*(e[18]+e[174])+-.00021158452917708308*(e[19]+e[173])+-.00025535069106550544*(e[20]+e[172])+-.00026228714374322104*(e[21]+e[171])+-.000222588059270278*(e[22]+e[170])+-.00013323230495695704*(e[23]+e[169])+.00016182578767055206*(e[25]+e[167])+.0003284617538509658*(e[26]+e[166])+.00047045611576184863*(e[27]+e[165])+.0005571385145753094*(e[28]+e[164])+.0005621256512151873*(e[29]+e[163])+.0004690191855396248*(e[30]+e[162])+.00027624866838952986*(e[31]+e[161])+-.0003256417948683862*(e[33]+e[159])+-.0006518231028671039*(e[34]+e[158])+-.000921277873093193*(e[35]+e[157])+-.0010772534348943575*(e[36]+e[156])+-.0010737727700273478*(e[37]+e[155])+-.0008855664539039263*(e[38]+e[154])+-.0005158189609076553*(e[39]+e[153])+.0005954876719379528*(e[41]+e[151])+.0011803558710661009*(e[42]+e[150])+.001652732027036987*(e[43]+e[149])+.0019152679330965555*(e[44]+e[148])+.0018927324805381538*(e[45]+e[147])+.0015481870327877937*(e[46]+e[146])+.0008947069583494131*(e[47]+e[145])+-.0010178225878206125*(e[49]+e[143])+-.002003740055205429*(e[50]+e[142])+-.0027874356824117317*(e[51]+e[141])+-.003210329988021943*(e[52]+e[140])+-.0031540624117984395*(e[53]+e[139])+-.0025657163651900345*(e[54]+e[138])+-.0014750752642111449*(e[55]+e[137])+.0016624165446378462*(e[57]+e[135])+.003259119283906918*(e[58]+e[134])+.004516568581586775*(e[59]+e[133])+.00518389843461239*(e[60]+e[132])+.005077426469745993*(e[61]+e[131])+.0041192521414141585*(e[62]+e[130])+.002362857541796649*(e[63]+e[129])+-.002654350786675918*(e[65]+e[127])+-.0051990251084333425*(e[66]+e[126])+-.0072020238234656924*(e[67]+e[125])+-.008267292819200736*(e[68]+e[124])+-.008103373957295629*(e[69]+e[123])+-.006583111539570221*(e[70]+e[122])+-.0037839040415292386*(e[71]+e[121])+.004278125285115251*(e[73]+e[119])+.008417635859832018*(e[74]+e[118])+.01172566057463055*(e[75]+e[117])+.013550476647788672*(e[76]+e[116])+.013388189369997496*(e[77]+e[115])+.010979501242341259*(e[78]+e[114])+.006381274941685413*(e[79]+e[113])+-.007421229604153888*(e[81]+e[111])+-.01486456304340213*(e[82]+e[110])+-.021143584622178104*(e[83]+e[109])+-.02504275058758609*(e[84]+e[108])+-.0254735309425472*(e[85]+e[107])+-.021627310017882196*(e[86]+e[106])+-.013104323383225543*(e[87]+e[105])+.017065133989980476*(e[89]+e[103])+.03697891926445195*(e[90]+e[102])+.05823318062093958*(e[91]+e[101])+.07907201208140595*(e[92]+e[100])+.09767599871695232*(e[93]+e[99])+.11236045936950932*(e[94]+e[98])+.12176343577287731*(e[95]+e[97])+.125*e[96];for(let t=0;t<DECIMATE_FACTOR;t++)e[FIR_SIZE-DECIMATE_FACTOR+t]=e[t];return t}dcFilter(e,t,i){return e.sum+=-e.delay[t]+i,e.delay[t]=i,i-e.sum/DC_FILTER_SIZE}process(e){for(let t=0;t<e;t++){let e;const i=this.interpolatorOutput.c,s=this.interpolatorOutput.y,n=FIR_SIZE-this.firIndex*DECIMATE_FACTOR,o=this.firOutput.subarray(n);this.firIndex=(this.firIndex+1)%(FIR_SIZE/DECIMATE_FACTOR-1);for(let n=DECIMATE_FACTOR-1;n>=0;n--)this.x+=this.step,this.x>=1&&(this.x--,s[0]=s[1],s[1]=s[2],s[2]=s[3],this.updateMixer(t),s[3]=this.output[t],e=s[2]-s[0],i[0]=.5*s[1]+.25*(s[0]+s[2]),i[1]=.5*e,i[2]=.25*(s[3]-s[1]-e)),o[n]=(i[2]*this.x+i[1])*this.x+i[0];this.output[t]=this.decimate(o),this.output[t]=this.dcFilter(this.dcOutput,this.dcIndex,this.output[t]),this.dcIndex=this.dcIndex+1&DC_FILTER_SIZE-1}}writeRegister(e,t){this.registers[e]=t,this.setTone(0,this.registers[1]<<8|this.registers[0]),this.setTone(1,this.registers[3]<<8|this.registers[2]),this.setTone(2,this.registers[5]<<8|this.registers[4]),this.setNoise(this.registers[6]),this.setMixer(0,1&this.registers[7],this.registers[7]>>3&1,this.registers[8]>>4),this.setMixer(1,this.registers[7]>>1&1,this.registers[7]>>4&1,this.registers[9]>>4),this.setMixer(2,this.registers[7]>>2&1,this.registers[7]>>5&1,this.registers[10]>>4),this.setVolume(0,15&this.registers[8]),this.setVolume(1,15&this.registers[9]),this.setVolume(2,15&this.registers[10]),this.setEnvelope(this.registers[12]<<8|this.registers[11]),255!=this.registers[13]&&this.setEnvelopeShape(this.registers[13])}constructor(e,t){this.channels=[new ToneChannel,new ToneChannel,new ToneChannel],this.registers=new Uint8Array(14),this.noisePeriod=0,this.noiseCounter=0,this.noise=1,this.envelopes=[[this.slideDown,this.holdBottom],[this.slideDown,this.holdBottom],[this.slideDown,this.holdBottom],[this.slideDown,this.holdBottom],[this.slideUp,this.holdBottom],[this.slideUp,this.holdBottom],[this.slideUp,this.holdBottom],[this.slideUp,this.holdBottom],[this.slideDown,this.slideDown],[this.slideDown,this.holdBottom],[this.slideDown,this.slideUp],[this.slideDown,this.holdTop],[this.slideUp,this.slideUp],[this.slideUp,this.holdTop],[this.slideUp,this.slideDown],[this.slideUp,this.holdBottom]],this.envelopeCounter=0,this.envelopePeriod=0,this.envelopeShape=0,this.envelopeSegment=0,this.envelope=0,this.setEnvelope(1),this.dacTable=new Float64Array([0,0,.00465400167849,.00772106507973,.0109559777218,.0139620050355,.0169985503929,.0200198367285,.024368657969,.029694056611,.0350652323186,.0403906309606,.0485389486534,.0583352407111,.0680552376593,.0777752346075,.0925154497597,.111085679408,.129747463188,.148485542077,.17666895552,.211551079576,.246387426566,.281101701381,.333730067903,.400427252613,.467383840696,.53443198291,.635172045472,.75800717174,.879926756695,1]),this.step=e/(8*t*DECIMATE_FACTOR),this.x=0,this.output=new Float64Array(t),this.interpolatorOutput={c:new Float64Array(4),y:new Float64Array(4)},this.dcOutput={sum:0,delay:new Float64Array(DC_FILTER_SIZE)},this.dcIndex=0,this.firOutput=new Float64Array(2*FIR_SIZE),this.firIndex=0;for(let e=0;e<this.channels.length;e++)this.setTone(e,1)}}const FREQ_BITS=16,DEF_GAIN=8;class Channel{constructor(){this.key=0,this.volume=0,this.counter=0,this.frequency=0,this.waveram=new Array(32)}}class SCC{process(e){const t=new Int16Array(this.output.length);for(let i=0;i<5;i++){const s=this.voice[i].frequency;if(s>8){const n=this.voice[i].waveram,o=this.voice[i].volume*this.voice[i].key;let r=this.voice[i].counter;const a=this.clock*(1<<FREQ_BITS)/(16*(s+1)*(this.rate/32))+.5;for(let i=0;i<e;i++){const e=(r+=a)>>FREQ_BITS&31;t[i]+=n[e]*o>>3}this.voice[i].counter=r}}for(let i=0;i<e;i++)t[i]=this.mixerTable[this.mixerLookup+t[i]],this.output[i]=t[i]/32768}setWaveform(e,t){64&this.test||128&this.test&&e>=96||(e>=96?(this.voice[3].waveram[31&e]=t,this.voice[4].waveram[31&e]=t):this.voice[e>>5].waveram[31&e]=t)}getWaveform(e){return 192&this.test&&(e>=96?e+=this.voice[3+(this.test>>6&1)].counter>>FREQ_BITS:64&this.test&&(e+=this.voice[e>>5].counter>>FREQ_BITS)),this.voice[e>>5].waveram[31&e]}setWaveformPlus(e,t){64&this.test||(this.voice[e>>5].waveram[31&e]=t)}getWaveformPlus(e){return 64&this.test&&(e+=this.voice[e>>5].counter>>FREQ_BITS),this.voice[e>>5].waveram[31&e]}setVolume(e,t){this.voice[7&e].volume=15&t}setFrequency(e,t){const i=this.voice[e>>1];32&this.test?i.counter=-1:i.frequency<9&&(i.counter|=(1<<FREQ_BITS)-1),i.frequency=1&e?255&i.frequency|t<<8&3840:3840&i.frequency|t<<0,i.counter&=4294901760}setKeyOnOff(e){for(let t=0;t<5;t++)this.voice[t].key=1&e,e>>=1}setTest(e){this.test=e}getTest(){return this.setTest(255),255}writeRegister(e,t){switch(1&e){case 0:this.currentRegister=t;break;case 1:switch(e>>1){case 0:this.setWaveform(this.currentRegister,t);break;case 1:this.setFrequency(this.currentRegister,t);break;case 2:this.setVolume(this.currentRegister,t);break;case 3:this.setKeyOnOff(t);break;case 4:this.setWaveformPlus(this.currentRegister,t);break;case 5:this.setTest(t)}}}constructor(e,t){this.voice=[new Channel,new Channel,new Channel,new Channel,new Channel],this.clock=2147483647&e,this.rate=this.clock/16,this.output=new Float64Array(t),this.mixerTable=new Int16Array(2561),this.mixerLookup=1280;for(let e=0;e<1281;e++){let t=e*DEF_GAIN*16/5;t>32768&&(t=32768),this.mixerTable[this.mixerLookup+e]=t,this.mixerTable[this.mixerLookup-e]=-t}this.currentRegister=0,this.test=0}}class OPM{process(e){this.outputLeft[0]=e,this.outputRight[0]=e}writeRegister(e,t){this.clock=e,this.outputRate=t}constructor(e,t){this.clock=e,this.outputLeft=new Float64Array(t),this.outputRight=new Float64Array(t),this.outputRate=t}}class PCM{process(e){this.output[0]=e}writeRegister(e,t){this.clock=e,this.outputRate=t}constructor(e,t){this.clock=e,this.output=new Float64Array(t),this.outputRate=t}}const BUFFER_SIZE=4096,MASTER_RATE=44100;function runCommand(e,t,i){const s=t.data.getUint8(i.vgmPosition);let n=0;if(160==s){const s=t.data.getUint8(i.vgmPosition+1),n=t.data.getUint8(i.vgmPosition+2);e.PSG.writeRegister(s,n),i.vgmPosition+=3}else if(210==s){const s=t.data.getUint8(i.vgmPosition+1),n=t.data.getUint8(i.vgmPosition+2),o=t.data.getUint8(i.vgmPosition+3);e.SCC.writeRegister(s<<1|0,n),e.SCC.writeRegister(s<<1|1,o),i.vgmPosition+=4}else if(84==s){const s=t.data.getUint8(i.vgmPosition+1),n=t.data.getUint8(i.vgmPosition+2);e.OPM.writeRegister(0,s),e.OPM.writeRegister(1,n),i.vgmPosition+=3}else if(183==s){const s=t.data.getUint8(i.vgmPosition+1),n=t.data.getUint8(i.vgmPosition+2);e.PCM.writeRegister(s,n),i.vgmPosition+=3}else if(103==s){const e=t.data.getUint32(i.vgmPosition+2,!0);i.vgmPosition+=6+e}else 97==s?(n=t.data.getUint16(i.vgmPosition+1,!0),i.vgmPosition+=3):98==s?(n=735,i.vgmPosition+=1):99==s?(n=882,i.vgmPosition+=1):s>=112&&s<=127?(n=1+(15&s),i.vgmPosition+=1):102==s?t.loopOffset&&i.currentLoop<=i.loopCount?(i.vgmPosition=t.loopOffset+28,i.currentLoop++):n=-1:(console.log(`Unknown command ${s} at ${i.vgmPosition}`),i.vgmPosition+=1);return n}function getBuffer(e,t,i,s,n){const o=e.outputBuffer.getChannelData(0),r=e.outputBuffer.getChannelData(1);let a=0;for(;;){let e;if(0==s.remainingWait){if(-1==(e=runCommand(t,i,s)))return n.disconnect(),!1}else e=s.remainingWait,s.remainingWait=0;if(e+a>=BUFFER_SIZE&&(s.remainingWait=e+a-BUFFER_SIZE,e=BUFFER_SIZE-a),e>0){i.ay8910Clock&&t.PSG.process(e),i.k051649Clock&&t.SCC.process(e),i.ym2151Clock&&t.OPM.process(e),i.okim6258Clock&&t.PCM.process(e);for(let s=0;s<e;s++){let e=0,n=0;i.ay8910Clock&&(e+=t.PSG.output[s],n+=t.PSG.output[s]),i.k051649Clock,i.ym2151Clock,i.okim6258Clock,o[a+s]=e,r[a+s]=n}a+=e}if(a>=BUFFER_SIZE)return!0}}function Player(e,t,i){if(!(e.ay8910Clock||e.k051649Clock||e.ym2151Clock||e.okim6258Clock))throw"No supported chips! Sorry, only AY8910, & K051649, YM2151 & OKIM6258 are supported!";if(e.ay8910Multiplier>1||e.k051649Multiplier>1||e.ym2151Multiplier>1||e.okim6258Multiplier>1)throw"Sorry, dual chip support hasn't been implemented yet!";const s={PSG:new PSG(e.ay8910Clock,MASTER_RATE),SCC:new SCC(e.k051649Clock,MASTER_RATE),OPM:new OPM(e.ym2151Clock,MASTER_RATE),PCM:new PCM(e.okim6258Clock,MASTER_RATE)},n={loopCount:i,currentLoop:0,vgmPosition:52+e.vgmDataOffset,remainingWait:0,sampleRate:t.sampleRate},o=t.createScriptProcessor(BUFFER_SIZE,0,2);o.onaudioprocess=(t=>getBuffer(t,s,e,n,o)),o.connect(t.destination)}const OPMA={loadVGM:VGM,playVGM:Player};export default OPMA;